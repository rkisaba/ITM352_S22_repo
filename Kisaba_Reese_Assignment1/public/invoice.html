<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="products_data.js" type="text/javascript"></script>
    <link rel="stylesheet" href="style_sheet.css">
    <title>F.O.R. Checkout</title>

    <script> // recieving data from server
        // searching for the parameters in a new URL document location
        let params = (new URL(document.location)).searchParams; 
        // create quantities variable
        var quantities = [];
        // if form was submitted by the user, process the invoice page
        if (params.has('purchase_submit')) {
            for (i = 0; i < products_array.length; i++) {
                if (params.has(`quantity${i}`)) {
                    a_qty = params.get(`quantity${i}`);
                    quantities[i] = a_qty;
                }
            }
        } else {
            document.write('no form submitted');
        }
        console.log(quantities);
    </script>
</head>

<body>
    <div class="invoice_header"> <!-- header -->
        <h1>Let's see what's in your cart...</h1>
    </div>

    <div class="invoice_display"> <!-- displaying all ordered products -->
        <script>
            for (i = 0; i < products_array.length; i++){ // goes through each product and displays info
                if (quantities[i] != 0){
                    document.write(`
                        <div class='invoice_items'>
                            <img src='${products_array[i]['image']}'
                            <h2>${products_array[i]['product']}</h2>
                            <p>Quantity: ${quantities[i]}</p>
                            <p>$${products_array[i]['price'].toFixed(2)}</p>
                            <p>Total: $${(Number(products_array[i]['price']) * Number(quantities[i])).toFixed(2)}</p>
                        </div>
                    `)
                }
            }
        </script>
    </div>

    <div class="invoice_table"> <!-- reciept table -->
        <table>
            <th>Item</th>
            <th>Quantity Added</th>
            <th>Price Per Item</th>
            <th>Extended Price</th>
            <script>
                var subtotal = 0; // subtotal price
                for (i = 0; i < products_array.length; i++){ // loops through all products to print info
                    var extended_price = (products_array[i]['price'] * quantities[i]);
                    subtotal = subtotal + extended_price;
                    if (quantities[i] != 0){
                        document.write(`
                            <tr>
                                <td>${products_array[i]['item']}</td>
                                <td>${quantities[i]}</td>
                                <td>$${products_array[i]['price'].toFixed(2)}</td>
                                <td>$${(products_array[i]['price'] * quantities[i]).toFixed(2)}
                            </tr>
                        `)
                    }
                }
                var tax = (subtotal * 0.04712); // tax
                var shipping = 0; // shipping
                if (subtotal < 20){ // subtotal if less than $20
                    shipping = 3;
                } else if (subtotal >= 20 & subtotal < 50){ // subtotal if less than $50 and over $20
                    shipping = 5;
                } else if (subtotal >= 50) { // subtotal if more than $50
                    shipping = subtotal * 0.05;
                }
                var total = (subtotal + shipping + tax) // calcualting grand total

                // displaying subtotal, tax, shipping, and grand total
                document.write(`
                    <tr>
                        <td colspan='3'>Subtotal</td>
                        <td>$${subtotal.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td colspan='3'>Tax (4.712%)</td>
                        <td>$${tax.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td colspan='3'>Shipping</td>
                        <td>$${shipping.toFixed(2)}</td>
                    </tr>
                    <tr>
                        <th colspan='3'>Total</th>
                        <td>$${total.toFixed(2)}</td>    
                    </tr>
                `)
            </script>
        </table>
        <div class="invoice_shipping"> <!-- shipping policy -->
            <h2>Our Shipping Policy:</h2>
            <p>$0 - $19.99: $3</p>
            <p>$20.00 - $49.99: $5</p>
            <p>$50.00+: 5% of subtotal</p>
        </div>
    </div>
</body>
</html>